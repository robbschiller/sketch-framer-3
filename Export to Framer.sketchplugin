// Export to Framer 3 (ctrl alt cmd f)

(function(){
// Setup
var export_path = "{doc_name}.framer", // This is relative to the saved document's path
    json_filename = 'layers.json',
    DEBUG = true

#import 'sandbox.js'
#import 'sketch-framer.js'

log("ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶ğŸ”¶")

// Some sanity checks, before we begin:
var error = check_for_errors()

if(error) { // Stop execution and display error
  log(error)
  alert("Make sure to fix these before we can continue:\n\n" + error)
} else { // Let's go
  log("ğŸ’ Framer, here we goâ€¦")

  // Setup
  var ViewsMetadata = new MetadataExtractor()

  // Authorize
  authorize_app_to_save()
  make_export_folder()

  var views = extract_views_from_document()
  for(var i=0; i< [views count]; i++){
    var view = [views objectAtIndex:i]
    export_assets_for_view(view)
  }

  // Traverse hierarchy to extract metadata
  if (document_has_artboards()) {
    var artboards = [[doc currentPage] artboards]
    for(var a=0; a < [artboards count]; a++){
      var artboard = [artboards objectAtIndex:a]
      ViewsMetadata.addView(artboard)
    }
  } else {
    var layers = [[doc currentPage] layers]
    for(var l=0; l < [layers count]; l++){
      var lay = [layers objectAtIndex:l]
      if(view_should_be_extracted(lay)){
        ViewsMetadata.addView(lay)
      }
    }
  }

  save_structure_to_json(ViewsMetadata)

  // All done!
  [doc showMessage:"Export Complete"]
}
}())
